{"version":3,"file":"tap.js","sourceRoot":"","sources":["tap.ts"],"names":[],"mappings":"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","sourcesContent":["import { jack } from '../dist/commonjs/index.js'\n\nimport * as os from 'node:os'\nconst defaultParallel = Math.max(\n  16,\n  typeof os.availableParallelism === 'function'\n    ? os.availableParallelism()\n    : Math.min(os.cpus().length, 1)\n)\n\nconst coverageReporters = [\n  'clover',\n  'cobertura',\n  'html',\n  'json',\n  'json-summary',\n  'lcov',\n  'lcovonly',\n  'none',\n  'teamcity',\n  'text',\n  'text-lcov',\n  'text-summary',\n]\n\nconst j = jack({\n  envPrefix: 'TAP',\n  allowPositionals: true,\n  env: process.env,\n  usage: 'tap [<options>] [<cmd> ...[<args>]]',\n})\n  .description(\n    `Executes all the files and interprets their output as TAP\n     formatted test result data.  If no files are specified, then\n     tap will search for testy-looking files, and run those.\n     (See '--test-regex' below.)\n\n     To parse TAP data from stdin, specify \"-\" as a filename.\n\n     Short options are parsed gnu-style, so for example '-bCRspec' would be\n     equivalent to '--bail --no-color --reporter=spec'\n\n     Coverage is not enabled for stdin.\n\n     Much more documentation available at: https://www.node-tap.org/`\n  )\n\n  .heading('The best Foo that ever Fooed')\n  .description(\n    `\n    Executes all the files and interprets their output as\n    TAP formatted test result data.\n\n    To parse TAP data from stdin, specify \"-\" as a filename.\n\n    This is a list:\n\n    - one\n    - two\n    - three\n    `\n  )\n  .heading('Subcommands')\n  .description(\n    `several subcommands are available.\n\n     they are described below.`\n  )\n  .heading('bazzle', 2)\n  .description('Bazzle the bedazzled razzle mafazzale')\n  .heading('blorg', 3)\n  .description(\n    `When the grolb needs blorging, use this command\n     and it will make sure every asdf is a quux.`\n  )\n  .description(\n    `A pre-formatted description section\n\n     because\n '. \\\\   what if your usage banner\n  '- \\\\                 needs a baby elephant\n   / /_         .---.\n  / | \\\\\\\\,.\\\\/--.//    )\n  |  \\\\//        )/  / \n   \\\\  ' ^ ^    /    )____.----..  6\n    '.____.    .___/            \\\\._) \n       .\\\\/.                      )\n        '\\\\                       /\n        _/ \\\\/    ).        )    (\n       /#  .!    |        /\\\\    /\n       \\\\  C// #  /'-----''/ #  / \n    .   'C/ |    |    |   |    |mrf  ,\n    \\\\), .. .'OOO-'. ..'OOO'OOO-'. ..\\\\(,`,\n    { pre: true }\n  )\n\n  .heading('Basic Options', 2)\n  .optList({\n    plugin: {\n      hint: 'module',\n      description: `Configure the tap Test class with the specified plugin.\n\n                    Typically this is set in a .taprc file, not on the command\n                    line, and can be managed using the 'tap plugin <add|rm>'\n                    command.\n\n                    If the set of plugins does not match that which tap was\n                    built with previously, then it will rebuild the Test class\n                    prior to running tests.\n\n                    To *exclude* a plugin which has been previously included\n                    (perhaps by being part of tap's default set), add it to\n                    this list prefixed by a '!' character.`,\n    },\n  })\n\n  .opt({\n    reporter: {\n      short: 'R',\n      hint: 'reporter',\n      description: `Use the specified reporter.  Defaults to\n                    'base' when colors are in use, or 'tap'\n                    when colors are disabled.\n\n                    In addition to the built-in reporters provided by\n                    the treport and tap-mocha-reporter modules, the\n                    reporter option can also specify a command-line\n                    program or a module to load via require().\n\n                    Command-line programs receive the raw TAP output\n                    on their stdin.\n\n                    Modules loaded via require() must export either a\n                    writable stream class or a React.Component subclass.\n                    Writable streams are instantiated and piped into.\n                    React components are rendered using Ink, with tap={tap}\n                    as their only property.`,\n    },\n  })\n\n  .optList({\n    'reporter-arg': {\n      hint: 'arg',\n      short: 'r',\n      description: `Args to pass to command-line reporters.  Ignored when using\n                    built-in reporters or module reporters.`,\n    },\n  })\n\n  .opt({\n    'coverage-reporter': {\n      hint: 'type',\n      description: `Output coverage information using the specified\n                    istanbul coverage reporter type.\n\n                    Default is 'text' when running on the command line, or\n                    'text-lcov' when piping to coveralls.\n\n                    If 'html' is used, then the report will be opened in a web\n                    browser after running.\n\n                    This can be run on its own at any time after a test run\n                    that included coverage.\n\n                    Built-in coverage reporters:\n                    ${coverageReporters.join(' ')}`,\n    },\n  })\n\n  .flag({\n    // TODO: move to @tapjs/fixture plugin\n    'save-fixture': {\n      short: 'F',\n      description: 'Do not clean up fixtures created with t.testdir()',\n    },\n\n    bail: {\n      short: 'b',\n      description: 'Bail out on first failure',\n    },\n    'no-bail': {\n      short: 'B',\n      description: 'Do not bail out on first failure (default)',\n    },\n\n    comments: {\n      description: 'Print all tap comments to process.stderr',\n    },\n\n    color: {\n      short: 'c',\n      description: 'Use colors (Default for TTY)',\n    },\n    'no-color': {\n      short: 'C',\n      description: 'Do not use colors (Default for non-TTY)',\n    },\n\n    // TODO: move to @tapjs/snapshot plugin\n    snapshot: {\n      short: 'S',\n      description: `Generate snapshot files for 't.matchSnapshot()'\n                    assertions.`,\n    },\n\n    watch: {\n      short: 'w',\n      description: `Watch for changes in the test suite or covered program.\n\n                    Runs the suite normally one time, and from then on, re-run\n                    just the portions of the suite that are required whenever a\n                    file changes.\n\n                    Opens a REPL to trigger tests and perform various\n                    actions.`,\n    },\n\n    changed: {\n      short: 'n',\n      description: `Only run tests for files that have changed since the last\n                    run.\n\n                    If no prior test run data exists, then all default files\n                    are run, as if --changed was not specified.`,\n    },\n\n    save: {\n      short: 's',\n      description: `If <file> exists, then it should be a line- delimited list\n                    of test files to run.  If <file> is not present, then all\n                    command-line positional arguments are run.\n\n                    After the set of test files are run, any failed test files\n                    are written back to the save file.\n\n                    This way, repeated runs with -s<file> will re-run failures\n                    until all the failures are passing, and then once again run\n                    all tests.\n\n                    Its a good idea to .gitignore the file used for this\n                    purpose, as it will churn a lot.`,\n    },\n\n    // TODO: move to @tapjs/filter plugin\n    only: {\n      short: 'O',\n      description: `Only run tests with {only: true} option, or created with\n                    t.only(...) function.`,\n    },\n  })\n\n  .optList({\n    // TODO: move to @tapjs/filter plugin\n    grep: {\n      hint: 'pattern',\n      short: 'g',\n      description: `Only run subtests tests matching the specified pattern.\n\n                    Patterns are matched against top-level subtests in each\n                    file.  To filter tests at subsequent levels, specify this\n                    option multiple times.\n\n                    To specify regular expression flags, format pattern like a\n                    JavaScript RegExp literal.  For example: '/xyz/i' for\n                    case-insensitive matching.`,\n    },\n  })\n\n  .flag({\n    // TODO: move to @tapjs/filter plugin\n    invert: {\n      short: 'i',\n      description: 'Invert the matches to --grep patterns. (Like grep -v)',\n    },\n    'no-invert': {\n      short: 'I',\n      description:\n        'Do not invert the matches to --grep patterns. (default)',\n    },\n\n    diag: {\n      description: `Set to show diagnostics by default for both passing tests.\n                    If not set, then diagnostics are printed by default for\n                    failing tests, and not for passing tests.`,\n    },\n    'no-diag': {\n      description: `Do not show diagnostics by default for passing or failing\n                    tests. If not set, then diagnostics are printed by default\n                    for failing tests, and not for passing tests.`,\n    },\n  })\n  .num({\n    timeout: {\n      hint: 'n',\n      short: 't',\n      default: 30,\n      description: `Time out test files after <n> seconds. Defaults to 30.\n                    Setting to 0 allows tests to run forever.\n\n                    When a test process calls t.setTimeout(n) on the top-level\n                    tap object, it also updates this value for that specific\n                    process.`,\n    },\n  })\n\n  .optList({\n    files: {\n      hint: 'filename',\n      description: `Alternative way to specify test set rather than using\n                    positional arguments.  Supported as an option so that\n                    test file arguments can be specified in .taprc and\n                    package.json files.`,\n    },\n  })\n\n  .heading('Test Running Options')\n\n  .num({\n    jobs: {\n      hint: 'n',\n      short: 'j',\n      default: defaultParallel,\n      description: `Run up to <n> test files in parallel.\n\n                    By default, this will be set to the number of CPUs on\n                    the system (${defaultParallel}).\n\n                    Set --jobs=1 to disable parallelization entirely.`,\n    },\n  })\n\n  .opt({\n    before: {\n      hint: 'module',\n      description: `A node program to be run before test files are executed.\n\n                    Exiting with a non-zero status code or a signal will fail\n                    the test run and exit the process in error.`,\n    },\n\n    after: {\n      hint: 'module',\n      description: `A node program to be executed after tests are finished.\n\n                    This will be run even if a test in the series fails with\n                    a bailout, but it will *not* be run if a --before script\n                    fails.\n\n                    Exiting with a non-zero status code or a signal will fail\n                    the test run and exit the process in error.`,\n    },\n\n    'output-file': {\n      hint: 'filename',\n      short: 'o',\n      description: `Send the raw TAP output to the specified file.  Reporter\n                    output will still be printed to stdout, but the file will\n                    contain the raw TAP for later replay or analysis.`,\n    },\n\n    'output-dir': {\n      hint: 'dir',\n      short: 'd',\n      description: `Send the raw TAP output to the specified directory.  A\n                    separate .tap file will be created for each test file that\n                    is run.  Reporter output will still be printed to stdout,\n                    but the files will contain the raw TAP for later replay or\n                    analysis.\n\n                    Files will be created to match the folder structure and\n                    filenames of test files run, but with '.tap' appended to\n                    the filenames.`,\n    },\n\n    include: {\n      hint: 'pattern',\n      default:\n        '**/{' +\n        'test*(s)|__test*(s)__)/**/*,' +\n        '*.@(test*(s)|spec),' +\n        'test*(s)' +\n        '}.([mc]js|[jt]s*(x))',\n      description: `A glob expression pattern indicating tests to run if no\n                    positional arguments are provided to the 'tap run' command.\n\n                    By default, tap will search for all files ending in .ts,\n                    .tsx, .cts, .mts, .js, .jsx, .cjs, or .mjs, in a top-level\n                    folder named test, tests, or __tests__, or any file ending\n                    in '.spec.' or '.test.' before a supported extension, or a\n                    top-level file named 'test.(js,jsx,...)' or\n                    'tests.(js,jsx,...)'\n\n                    No files excluded by the 'exclude' option will be loaded,\n                    meaning so dependencies, build artifacts in 'dist', and\n                    test fixtures and snapshots will be ignored.`,\n    },\n\n    exclude: {\n      hint: 'pattern',\n      default: '**/@(fixture*(s)|dist)/**',\n      description: `A glob pattern indicating which filenames should NEVER\n                    be run as tests.  This overrides the 'include' option.\n\n                    Defaults to excluding any folders named dist, fixture, or\n                    fixtures.\n\n                    Note: folders named tap-snapshots, node_modules, .git, and\n                    .hg are ALWAYS excluded from the default test file set.  If\n                    you wish to run tests in these folders, then name the test\n                    files on the command line as positional arguments.`,\n    },\n  })\n\n  .optList({\n    'test-arg': {\n      hint: 'arg',\n      description: `Pass an argument to test files spawned by the tap command\n                    line executable. This can be specified multiple times to\n                    pass multiple args to test scripts.`,\n    },\n\n    'test-env': {\n      hint: 'key=value',\n      description: `Pass a key=value (ie, --test-env=key=value) to set an\n                    environment variable in the process where tests are run.\n\n                    If a value is not provided, such as '--test-env=key', then\n                    the key is ensured to not be set in the environment.  To\n                    set a key to the empty string, use --test-env=key=`,\n    },\n\n    'node-arg': {\n      hint: 'arg',\n      // this is one that the mock plugin might want to add to?\n      // or should we just always force our loaders in?\n      description: `Pass an argument to Node binary in all child processes.\n                    Run 'node --help' to see a list of all relevant arguments.\n                    This can be specified multiple times to pass multiple args\n                    to Node.`,\n    },\n  })\n\n  .heading('Other Options')\n\n  .flag({\n    debug: { description: 'Turn on debug mode' },\n\n    versions: {\n      short: 'V',\n      description:\n        'Show the version of tap and relevant tap libraries in use.',\n    },\n\n    version: {\n      short: 'v',\n      description: 'Show the version of this program.',\n    },\n\n    help: {\n      short: 'h',\n      type: 'boolean',\n      description: 'show this help banner',\n    },\n  })\n\ntry {\n  const { values, positionals } = j.parse()\n  if (values.help) console.log(j.usage())\n  else {\n    console.log({ values, positionals })\n    console.log(\n      Object.entries(process.env).filter(([k]) => k.startsWith('TAP'))\n    )\n  }\n} catch (e) {\n  console.error(e)\n}\n"]}